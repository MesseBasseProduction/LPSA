!function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}e.d(t,{default:function(){return c}});var a=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);try{this._container=document.querySelector(t.target),this._onDropFileCB=t.onDropFile,this._borderStyle=this._container.style.border,this._events()}catch(e){console.error("Unable to build the DnD class.\n".concat(e))}},n=[{key:"formatAsJSON",value:function(e){return JSON.parse(e)}}],(t=[{key:"_events",value:function(){this._container.addEventListener("dragenter",this._dragEnter.bind(this),!1),this._container.addEventListener("dragover",this._dragOver.bind(this),!1),this._container.addEventListener("dragleave",this._dragLeave.bind(this),!1),this._container.addEventListener("drop",this._drop.bind(this),!1)}},{key:"_eventBehavior",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"_dragEnter",value:function(e){this._eventBehavior(e),this._container.style.border="dashed 6px rgb(255, 100, 100)"}},{key:"_dragOver",value:function(e){this._eventBehavior(e),e.dataTransfer.dropEffect="copy"}},{key:"_dragLeave",value:function(e){null===e.relatedTarget&&(this._eventBehavior(e),this._container.style.border=this._borderStyle)}},{key:"_drop",value:function(e){var t=this;this._eventBehavior(e),this._container.style.border=this._borderStyle;for(var n=e.dataTransfer.files,r=0;r<n.length;++r){var o=new FileReader;o.onload=function(e){return function(n){t._onDropFileCB(e,n)}}(n[r]),o.readAsText(n[r])}}}])&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}var c=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._version="0.0.2",this._mainScroll=null,this._asideScroll=null,this._dndController=null,this._input=[[0,0,0],[0,0,0],[0,0,0]],this._tensThreshold=0,this._resultsAmount=1,this._precision=75,this._db=null,this._perf={db:{m1:null,m2:null},analysis:{m1:null,m2:null}},this._initApp().then(this._events.bind(this)).then(this._finalizeInit.bind(this)).catch((function(e){console.error("LPSA v".concat(t._version," : Fatal error during initialization, please contact support :\n"),e)}))},t=[{key:"_initApp",value:function(){var e=this;return new Promise((function(t){e._dndController=new a({target:".dnd-container",onDropFile:function(t,n){"application/json"===t.type?e._fillDatabase(a.formatAsJSON(n.target.result)):(window.notification.error({message:"Format de fichier non pris en charge pour l'import de la base de donnée"}),document.getElementById("feedback-label").innerHTML="Le fichier déposé n'est pas au format supporté (.JSON).")}});var n=window.localStorage.getItem("session-db");null!==n&&e._fillDatabase(JSON.parse(n)),t()}))}},{key:"_events",value:function(){document.querySelector("#t1-1").addEventListener("input",this._updateInputNumber.bind(this,"1/1")),document.querySelector("#t1-2").addEventListener("input",this._updateInputNumber.bind(this,"1/2")),document.querySelector("#t1-3").addEventListener("input",this._updateInputNumber.bind(this,"1/3")),document.querySelector("#t2-1").addEventListener("input",this._updateInputNumber.bind(this,"2/1")),document.querySelector("#t2-2").addEventListener("input",this._updateInputNumber.bind(this,"2/2")),document.querySelector("#t2-3").addEventListener("input",this._updateInputNumber.bind(this,"2/3")),document.querySelector("#t3-1").addEventListener("input",this._updateInputNumber.bind(this,"3/1")),document.querySelector("#t3-2").addEventListener("input",this._updateInputNumber.bind(this,"3/2")),document.querySelector("#t3-3").addEventListener("input",this._updateInputNumber.bind(this,"3/3")),document.querySelector("#aside-toggle").addEventListener("click",this._toggleAside.bind(this)),document.querySelector("#threshold-range").addEventListener("input",this._updateThresholdRange.bind(this)),document.querySelector("#results-range").addEventListener("input",this._updateResultsRange.bind(this)),document.querySelector("#precision-range").addEventListener("input",this._updatePrecisionRange.bind(this)),document.querySelector("#clear-input").addEventListener("click",this._clearInputs.bind(this)),document.querySelector("#submit-input").addEventListener("click",this._submitInputs.bind(this)),document.querySelector("#modal-overlay").addEventListener("click",this._closeModal.bind(this))}},{key:"_finalizeInit",value:function(){return new Promise((function(e){document.querySelector("#loading-overlay").style.opacity=0,setTimeout((function(){document.querySelector("#loading-overlay").style.display="none",e()}),400)}))}},{key:"_fillDatabase",value:function(e){var t=this;if(!e.date||!e.data)return window.notification.error({message:"Le contenu de la base de donnée est mal formaté"}),void(document.getElementById("feedback-label").innerHTML="Le fichier déposé ne contiens pas les données attentudes.");window.localStorage.removeItem("session-db");var n=new Intl.DateTimeFormat("fr",{year:"numeric",month:"long",day:"numeric"}).format(new Date(e.date));document.getElementById("feedback-label").innerHTML="Import de la base de donnée du ".concat(n,"..."),document.getElementById("aside-content").innerHTML="",this._perf.db.m1=performance.now();for(var r=0;r<e.data.length;++r){var o=document.createElement("DIV");o.classList.add("series"),o.innerHTML="\n        <h2>Série ".concat(e.data[r].seriesLength,'/9</h2>\n        <h3>Parier <span class="go-for">Pour</span> :</h3>\n      ');for(var a=0;a<e.data[r].goFor.length;++a)o.appendChild(this._buildElement(e.data[r].goFor[a]));o.innerHTML+='<h3>Parier <span class="go-against">Contre</span></h3>';for(var i=0;i<e.data[r].goAgainst.length;++i)o.appendChild(this._buildElement(e.data[r].goAgainst[i]));document.getElementById("aside-content").appendChild(o)}this._db=e,window.localStorage.setItem("session-db",JSON.stringify(this._db)),this._asideScroll=new window.ScrollBar({target:document.getElementById("aside-content"),minSize:200,style:{color:"#758C78"}}),requestAnimationFrame((function(){t._asideScroll.updateScrollbar()})),this._perf.db.m2=performance.now(),window.notification.success({message:"Base de donnée du ".concat(n," chargée"),CBtitle:"Voir les données",callback:function(){return t._toggleAside()}}),document.getElementById("feedback-label").innerHTML="Base de donnée du ".concat(n," chargée en ").concat(((this._perf.db.m2-this._perf.db.m1)/1e3).toFixed(3)," seconde(s).")}},{key:"_buildElement",value:function(e){var t=document.createElement("P"),n=e.values;if(t.innerHTML='\n      <span class="value">'.concat(n[0][0],", ").concat(n[0][1],", ").concat(n[0][2]," / ").concat(n[1][0],", ").concat(n[1][1],", ").concat(n[1][2]," / ").concat(n[2][0],", ").concat(n[2][1],", ").concat(n[2][2],"</span>\n    "),e.additionnal.length>0){var r=e.additionnal;t.innerHTML+='\n        <span class="additionnal">'.concat(r[0][0],"-").concat(r[0][1],"-").concat(r[0][2]," / ").concat(r[1][0],"-").concat(r[1][1],"-").concat(r[1][2]," / ").concat(r[2][0],"-").concat(r[2][1],"-").concat(r[2][2],"</span>\n      ")}return""!==e.comment&&(t.innerHTML+='\n        <span class="comment">'.concat(e.comment,"</span>\n      ")),t}},{key:"_updateInputNumber",value:function(e,t){var n=e.split("/");if(2===n.length){if(!/[0-9]|\./.test(t.target.value))return t.target.classList.add("error"),setTimeout((function(){return t.target.classList.remove("error")}),1500),t.target.value=null,void(this._input[n[0]-1][n[1]-1]=0);t.target.classList.add("success"),setTimeout((function(){return t.target.classList.remove("success")}),1500),this._input[n[0]-1][n[1]-1]=parseInt(t.target.value)}else t.returnValue=!1}},{key:"_updateThresholdRange",value:function(e){var t=e.target.value;this._tensThreshold=parseInt(t),document.querySelector("#threshold-range-label").innerHTML="Tolérance ".concat(t)}},{key:"_updateResultsRange",value:function(e){var t=e.target.value;this._resultsAmount=parseInt(t),document.querySelector("#results-range-label").innerHTML="Nombre de resultats ".concat(t)}},{key:"_updatePrecisionRange",value:function(e){var t=e.target.value;this._precision=parseInt(t),document.querySelector("#precision-range-label").innerHTML="Précision minimale : ".concat(t,"%")}},{key:"_clearInputs",value:function(e){document.querySelector("#t1-1").value=null,document.querySelector("#t1-2").value=null,document.querySelector("#t1-3").value=null,document.querySelector("#t2-1").value=null,document.querySelector("#t2-2").value=null,document.querySelector("#t2-3").value=null,document.querySelector("#t3-1").value=null,document.querySelector("#t3-2").value=null,document.querySelector("#t3-3").value=null,this._input=[[0,0,0],[0,0,0],[0,0,0]],e.target.blur(),window.notification.info({message:"Les champs en entrée ont été nettoyés"})}},{key:"_submitInputs",value:function(e){if(null===this._db)return window.notification.warning({message:"Aucune base de donnée n'est chargée en mémoire"}),document.getElementById("feedback-label").innerHTML="Veuillez d'abord glisser-déposer n'importe ou sur la page le JSON de données.",void e.target.blur();for(var t=0,n=0;n<this._input.length;++n)for(var r=0;r<this._input[n].length;++r)this._input[n][r]>0&&++t;if(t<4)return window.notification.warning({message:"L'indice de valeur de cette serie est inférieur a 4/9"}),document.getElementById("feedback-label").innerHTML="Cette serie comporte moins de 4/9 valeurs et n'est pas pertinente à analyser.",void e.target.blur();this._seriesAnalysis(t)}},{key:"_seriesAnalysis",value:function(e){var t=this;document.getElementById("feedback-label").innerHTML="Démarrage de l'analyse, serie évaluée ".concat(e,"/9..."),this._perf.analysis.m1=performance.now();for(var n=null,r=0;r<this._db.data.length;++r)if(this._db.data[r].seriesLength===e){n=this._db.data[r];break}if(null===n)return window.notification.error({message:"Aucune donnée ".concat(e,"/9 à comparer")}),void(document.getElementById("feedback-label").innerHTML="Aucune donnée en base pour des séries evalués ".concat(e,"/9."));var o=function(e){for(var n=[],r=0;r<e.length;++r){for(var o=0,a=!0,i=0;i<3;++i)for(var s=0;s<3;++s){var l=parseInt("".concat(e[r].values[i][s]/10)[0]),c=parseInt("".concat(t._input[i][s]/10)[0]);0!==t._input[i][s]&&0===e[r].values[i][s]?a=!1:l===c||Math.abs(e[r].values[i][s]-t._input[i][s])<=t._tensThreshold?o+=Math.abs(e[r].values[i][s]-t._input[i][s]):a=!1}!0===a&&o<100&&100-o>=t._precision&&n.push({distance:o,series:e[r]})}return n},a=o(n.goFor),i=o(n.goAgainst);a=a.sort((function(e,t){return e.distance-t.distance})),i=i.sort((function(e,t){return e.distance-t.distance})),this._resultsModal(a,i),this._perf.analysis.m2=performance.now(),window.notification.success({message:"Analyse des données terminée"}),document.getElementById("feedback-label").innerHTML="Analyse de la serie terminée :  ".concat(a.length+i.length," résultat(s).")}},{key:"_toggleAside",value:function(){document.getElementById("bd-viewer").classList.contains("opened")?(document.getElementById("aside-toggle").innerHTML=">",document.getElementById("bd-viewer").classList.remove("opened")):(document.getElementById("aside-toggle").innerHTML="<",document.getElementById("bd-viewer").classList.add("opened"))}},{key:"_resultsModal",value:function(e,t){var n=this,r=document.getElementById("modal-overlay");fetch("assets/html/resultsmodal.html").then((function(o){r.style.display="flex",o.text().then((function(o){var a=document.createRange().createContextualFragment(o),i=n._input;a.querySelector("#studied-series").innerHTML="\n          ".concat(i[0][0],", ").concat(i[0][1],", ").concat(i[0][2]," / ").concat(i[1][0],", ").concat(i[1][1],", ").concat(i[1][2]," / ").concat(i[2][0],", ").concat(i[2][1],", ").concat(i[2][2],"\n        "),a.querySelector("#study-stats").innerHTML="\n          Un total de ".concat(e.length+t.length," résultat(s) ont été trouvés dans la base de donnée.<br>\n          Ces résultats ont été trouvés en ").concat(((n._perf.db.m2-n._perf.db.m1)/1e3).toFixed(3)," seconde(s).<br><br>\n          Le nombre de résultats à afficher par catégorie est de <b>").concat(n._resultsAmount,"</b>.<br>\n          La tolérance pour les calculs entre dizaines est de <b>").concat(n._tensThreshold,"</b>.<br>\n          La précision minimale pour ces résultats est de <b>").concat(n._precision,"%</b>.\n        ");for(var s=0;s<n._resultsAmount;++s){if(e[s]){var l=n._buildElement(e[s].series),c=document.createElement("DIV");c.classList.add("category-item"),c.innerHTML="\n              <h4>".concat(100-e[s].distance,"%</h4>\n            "),c.appendChild(l),a.querySelector("#go-for").appendChild(c)}if(t[s]){var u=n._buildElement(t[s].series),d=document.createElement("DIV");d.classList.add("category-item"),d.innerHTML="\n              <h4>".concat(100-t[s].distance,"%</h4>\n            "),d.appendChild(u),a.querySelector("#go-against").appendChild(d)}}var m=new window.ScrollBar({target:a.querySelector(".results-wrapper"),minSize:200,style:{color:"#758C78"}});requestAnimationFrame((function(){m.updateScrollbar()})),a.querySelector("#close-button").addEventListener("click",n._closeModal.bind(n)),r.appendChild(a),setTimeout((function(){return r.style.opacity=1}),50)}))})).catch((function(e){return console.error(e)}))}},{key:"_infoModal",value:function(){var e=document.getElementById("modal-overlay");fetch("assets/html/infomodal.html").then((function(t){e.style.display="flex",t.text().then((function(t){var n=document.createRange().createContextualFragment(t);e.appendChild(n),setTimeout((function(){return e.style.opacity=1}),50)}))})).catch((function(e){return console.error(e)}))}},{key:"_closeModal",value:function(e){if("modal-overlay"===e.srcElement.id||"close-modal"===e.srcElement.className||"close-button"===e.srcElement.id){var t=document.getElementById("modal-overlay");"flex"===t.style.display&&(t.style.opacity=0,setTimeout((function(){t.innerHTML="",t.style=""}),400))}}}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();window.LPSA=t.default}();